# Agent Deployment and Configuration Guide

This guide provides instructions for developers to package and distribute the user-side agent, and for end-users to install and configure it.

The agent is a Node.js application based on the `Claude-Code-Remote` project. It runs on a user's local machine, interacts with `tmux`, and communicates with a central `clwclw-monitor` coordinator server.

---

## Part 1: For Developers (Packaging and Distribution)

The `Claude-Code-Remote` agent can be easily distributed as an npm package.

### Prerequisites

-   [Node.js](https://nodejs.org/) (LTS version recommended)
-   An [npm](https://www.npmjs.com/) account

### Packaging Steps

1.  **Navigate to the agent directory:**
    ```bash
    cd Claude-Code-Remote
    ```

2.  **Update Version (Recommended):**
    Before publishing, it's good practice to update the version number in `package.json`.
    ```bash
    npm version patch # Or minor, major
    ```

3.  **Login to npm:**
    Log in to your npm account. You will be prompted for your username, password, and one-time password.
    ```bash
    npm login
    ```

4.  **Publish the Package:**
    Once logged in, you can publish the package.
    ```bash
    npm publish --access public
    ```
    The package is now available on the npm registry.

---

## Part 2: For End-Users (Installation and Usage)

### Prerequisites

-   [Node.js](https://nodejs.org/) (LTS version recommended)
-   `tmux`: The agent requires `tmux` to be installed on the local system.

### Installation

1.  **Install the agent package from npm:**
    Replace `<your-package-name>` with the name you published the package under.
    ```bash
    npm install -g <your-package-name>
    ```

2.  **Run the Interactive Setup:**
    After installation, run the setup command. This will generate a `.env` configuration file and configure Claude hooks.
    ```bash
    # This assumes the package.json has a "bin" entry pointing to setup.js
    # or the user needs to run it from the installation directory.
    # For a global install, a postinstall script or a clear bin command is best.
    # A typical setup command might be:
    clw-agent-setup 
    ```
    *Note: The exact command depends on how the `package.json` `bin` field is configured.*

### Configuration

The agent is configured via a `.env` file located in the directory where you run the agent. The setup process creates this file, but you must manually edit it to connect to the central coordinator.

**Key Environment Variables:**

-   `COORDINATOR_URL`: **(Required)** The full URL of the central coordinator server.
    -   Example: `COORDINATOR_URL=https://your-coordinator.example.com`

-   `COORDINATOR_AUTH_TOKEN`: **(Required)** The bearer token for authenticating with the coordinator API.
    -   Example: `COORDINATOR_AUTH_TOKEN=devtoken`

-   `AGENT_NAME`: (Optional) A friendly name for your agent. If not set, the machine's hostname will be used.
    -   Example: `AGENT_NAME=My-Dev-Agent`

-   `AGENT_ID`: (Optional) A persistent unique ID for the agent. If you leave this blank, the agent will automatically generate an ID and save it in `data/agent-id.txt` to be reused across restarts. It's recommended to let the agent handle this.

**Example `.env` file:**
```
# Required for connecting to the central monitor
COORDINATOR_URL=https://your-coordinator.example.com
COORDINATOR_AUTH_TOKEN=a-very-secret-token

# Optional agent name
AGENT_NAME=Primary-Dev-Box

# Other configurations generated by setup.js...
NOTIFY_EMAIL_ENABLED=true
...
```

### Running the Agent

Once configured, you can start the agent's services. This will begin the process of monitoring `tmux` and communicating with the coordinator.

```bash
# The command to start the main agent process
# This may be defined in your package.json scripts
npm run webhooks # Or a custom command like `clw-agent-start`
```
The agent will now run in the background, sending heartbeats to the coordinator and listening for tasks.
